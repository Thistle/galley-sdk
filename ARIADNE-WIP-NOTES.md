These are notes for the [`ariadne-codegen`](https://github.com/mirumee/ariadne-codegen) branch. We can delete this file after this work is complete, though at merge time we probably want to amend the README to reflect this significant change.

* Everything in `galley/client` is generated by ariadne-codegen. Do not make local changes (except perhaps for debugging). Safe to delete and recreate by running `ariadne-codegen`.
* Tests have not been updated.
* I tested this branch inside thistle-web, and after enabling the `pydantic.v1` compatibility layer for the Pydantic models in thistle-web (more on that below):
  * Refreshing the menus from Galley worked
  * Refreshing the recipes failed with a bunch of validation errors; not sure if the data or the validation was wrong.
* The queries should be the same as their old `sgqlc` equivalents, except that the menu query now uses `viewer.menuConnection` instead of the deprecated `viewer.menus`.
* The config currently uses `schema_path` to read a local copy of the Galley GQL schema, but for production we likely want to replace that with `remote_schema_url` to load the latest schema from Galley, and run `ariadne-codegen` in a build step somewhere, checking for:
  1. errors thrown, which could indicate a field we use has been removed/changed
  2. deprecation warnings
  3. differences in the generated code
* I got rid of a lot of the basic data-shape validation and error handling because the generated client handles a lot of this automatically:
  * if the server returns GraphQL errors, the ariadne client will raise exceptions, just like our code was going (albeit different exceptions)
  * I couldn't figure out a case where a) there's no top-level errors, but b) the returned data has a fundamentally different shape than the query. This is something the old code checked for (e.g., making sure `result['data']['viewer']` contained a `menus` key). Do we still need to check for it? I think maybe we'll figure this out when we update the tests, if we can mock the response GQL and see if perhaps an error is thrown when an expected top-level key is missing.
* Current version of the code was generated using `ariadne-codegen@c720473`, which is somewhere between v0.12 and v0.13. This was to address some pydantic-related errors I saw when testing this branch inside thistle-web. To install the same version I used, do `pip install git+https://github.com/mirumee/ariadne-codegen.git@c720473` (but if v0.13 is released by the time you see these, you can just `pip install ariadne-codegen`).
* Thistle-web currently uses pydantic v1 (also for Galley validation stuff), while ariadne-codegen uses v2. I think we'd have to upgrade thistle-web to v2 to integrate this branch. Pydantic v1 -> v2 is a [very hands-on upgrade](https://docs.pydantic.dev/latest/migration/), but they have an upgrade helper tool that handles some of the work, and they have a `pydantic.v1` interface for backwards-compatbility if we want to defer the work (but our usage is so limited that it's probably easy enough to just upgrade).
* By default, ariadne-codegen translates GraphQL camelCase to more Pythonic snake_cake. I have this disabled (`convert_to_snake_case = false`) for compatibility with the current Galley code in thistle-web, which expects camelCase. But it might be nice to update everything to snake_case. (Interestingly enough, sgqlc also supports this kind of conversion, but we don't use it. sgqlc's client first returns a dict of raw data and then expects you to hydrate a python representation of your data, but we just use the dicts directly... even though we later hydrate custom pydantic classes. ðŸ¤·)
* I tried to use `@include` and `@skip` to reduce duplication between the ops and non-ops versions of the menu query, but ariadne-codegen's validation code didn't seem to handle it properly; whichever version of the query I used, it complained that the fields from the other version of the query were missing. This is despite [past](https://github.com/mirumee/ariadne-codegen/issues/43) [issues](https://github.com/mirumee/ariadne-codegen/issues/204) suggesting it should be supported.
